---
title             : "A Walk In The Classroom - Using Fitbit Charge 4 to measure expert and novice teachers’ heart rate and step counts in a laboratory study"
shorttitle        : "Measuring novice and expert teachers' heart rate"

author: 
  - name          : "Mandy Klatt"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Dittrichring 5-7, 04109 Leipzig"
    email         : "mandy.klatt@uni-leipzig.de"
    role:         # Contributorship roles (e.g., CRediT, https://casrai.org/credit/)
      - "Conceptualization"
      - "Writing - Original Draft Preparation"
      - "Writing - Review & Editing"
  - name          : "Peer Keßler"
    affiliation   : "1"
    role:
      - "Writing - Original Draft Preparation"
      - "Writing - Review & Editing"
  - name          : "Gregor Kachel"
    affiliation   : "1,2"
    role:
      - "Conceptualization"
      - "Writing - Review & Editing"
  - name          : "Anne Deiglmayr"
    affiliation   : "1"
    role:
      - "Supervision"

affiliation:
  - id            : "1"
    institution   : "Leipzig University"
  - id            : "2"
    institution   : "Max Planck Institute for Evolutionary Anthropology"

authornote: |
  We received funding from QualiFond of University Leipzig. We have no conflicts of interest to disclose. This article is based on data used at conference presentations (DACH-Nachwuchsakademie, 2022; EARLI SIG 11, 2022; EARLI SIG 27, 2022). 
 
abstract: |
  One or two sentences providing a **basic introduction** to the field,  comprehensible to a scientist in any discipline.
  
  Two to three sentences of **more detailed background**, comprehensible  to scientists in related disciplines.
  
  One sentence clearly stating the **general problem** being addressed by  this particular study.
  
  One sentence summarizing the main result (with the words "**here we show**" or their equivalent).
  
  Two or three sentences explaining what the **main result** reveals in direct comparison to what was thought to be the case previously, or how the  main result adds to previous knowledge.
  
  One or two sentences to put the results into a more **general context**.
  
  Two or three sentences to provide a **broader perspective**, readily comprehensible to a scientist in any discipline.
  
  <!-- https://tinyurl.com/ybremelq -->
  
keywords          : "heart rate; photoplethysmography; wearable electronic device; expertise differences "
wordcount         : "X"

bibliography      : "r-references.bib"

floatsintext      : no
linenumbers       : yes
draft             : no
mask              : no

figurelist        : no
tablelist         : no
footnotelist      : no

classoption       : "man"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
library("papaja")
r_refs("r-references.bib")
```

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```

```{r include=FALSE}
# install.packages("needs")

# suppress "summarize" info. 
# if this line is ommitted, each table using the summarize function will be accompanied with a warning from the console
options(dplyr.summarise.inform = FALSE)

library(needs)

needs(tidyverse,
      lubridate,
      janitor,
      viridis,
      grid,
      gridExtra,
      cowplot,
      readxl,
      ARTofR,
      moments,
      ltm,
      sjPlot,
      kableExtra,
      xtable,
      DescTools,
      formattable)

```
# Introduction
Especially the first five years are a crucial time the teaching profession, whether the development from novice to expert is experienced as successful and as an increase in competence or leads to the fact that between 40 and 50 percent of the beginning teachers left the profession [@ingersoll2003wrong; @prilleltensky2016teacher]. One reason among many why teachers end their careers is the demanding workload and resulting stress in the teaching profession [@struyven2014teachers]. In her study with 400 secondary teachers, @fisher2011factors showed that burnout scores were significantly different between novice and experienced teachers, whereby novices had higher burnout. Furthermore, she found that low years of experience was a statistically significant predictor for stress in the teaching profession, along with job satisfaction and burnout.

XXX ÜBERGANG VON STRESS ZU HEART RATE XXX 

The heart rate is considered an indicator of physical or emotional stress. Increased workload is accompanied by increased heart rate. Therefore, heart rate can be considered the most important psycho physiological parameter [@sachs2014physiologische]. 

XXX ÜBERGANG VON HEART RATE ZU SMARTWATCHES - VORTEILE XXX low-cost, non-invasive, wrist-worn devices

There is a gap in research on whether heart rate measurements using fitness watches are appropriate to detect differences between experienced and inexperienced teachers in a laboratory setting.


## Aim of the study
The aim of the study was to uncover differences between 25 experienced and 25 inexperienced teachers on the physical and emotional demands during a 15-minute micro-teaching unit by measuring their heart rate using a fitness watch (Fitbit Charge 4). As the fitness watch was put on at the beginning of the survey and was not taken off until the entire data collection was completed, the heart rate could be measured in the resting and arousal states. In addition, the watch recorded the subjects' movement activity to determine how many steps were taken during the lesson. The practicality of the FitBit for classroom research is discussed. 


# Methods
We report how we determined our sample size, all data exclusions (if any), all manipulations, and all measures in the study. <!-- 21-word solution (Simmons, Nelson & Simonsohn, 2012; retrieved from http://ssrn.com/abstract=2160588) -->

## Participants
```{r demographicstable, include = TRUE, echo=FALSE}

# read in data and select and rename relevant columns with transmute 
demo.data <- 
  read_excel("./data/data_empschul_labor_lehrperson.xlsx") %>% 
  transmute(Group = LI06_05,
            Gender = LI02_01_1,
            Age = LI03_01,
            `Teaching Experience` = LI04_01,
            School_type = LI18,
            Grade = LI16_05,
            Subject = LI10_05,
            Semester = LI11_01,
            Internship = LI13_01,
            `Extracurricular Teaching Experience` = LI14,
            `Secondary Teaching Activities` = LI17
            )

# define expert and novice with ifelse function
demo.data$Group = ifelse(demo.data$Group < 200, "Novice","Expert")

# changing gender to count female gender (male = 2 --> 0)
demo.data$Gender = ifelse(demo.data$Gender == 2, "1","0")

# changing character Gender into numeric
demo.data$Gender <- as.numeric(demo.data$Gender)

# creating new column with total participants to calculate percent of gender
demo.data <- demo.data %>%
  group_by(Group) %>%
  mutate(Sum_participants = n())

# replacing 2 to 1 (Oberschule = Gymnasisium --> Secondary school)
demo.data$School_type[demo.data$School_type == 2] <- "1"

# creating new column to calculate percent of school type
demo.data <- 
  demo.data %>%
  group_by(School_type, Group) %>%
  mutate(Count_Schooltype = sum(n())) %>% 
  mutate(Percent_schooltype = round((Count_Schooltype/Sum_participants) * 100, 
         digits = 2))

# changing character Percent_schooltype into numeric
demo.data$Percent_schooltype <- as.numeric(demo.data$Percent_schooltype)

# changing character Semester into numeric
demo.data$Semester <- as.numeric(demo.data$Semester)


# changing Type of School into character
# LI18:
# 1: Grundschule
# 2: Oberschule
# 3: Gymnasium
# 4: Förderschule/Sondershausen
# 5: Berufsbildende Schule
# -1: andere Schulform
demo.data$School_type <- factor(x = demo.data$School_type,
                   levels = c("1","3","4","5","-1"), # Mögliche Werte # andere Möglichkeit: unique(demo.data$School_type)
                   labels = c("Primary School","Secondary School", "Special Education","Vocational School", "Other Schooltype")) # Bezeichnungen

# changing `Extracurricular Teaching Experience` to count experience (no experience = 2 --> 0)
demo.data$`Extracurricular Teaching Experience` = ifelse(demo.data$`Extracurricular Teaching Experience` == 1, "1","0")

# changing character Extra. Exp. into numeric
demo.data$`Extracurricular Teaching Experience` <- as.numeric(demo.data$`Extracurricular Teaching Experience`)

# changing `Secondary Teaching Activities` to count experience (no experience = 2 --> 0)
demo.data$`Secondary Teaching Activities` = ifelse(demo.data$`Secondary Teaching Activities` == 1, "1","0")

# changing character Extra. Exp. into numeric
demo.data$`Secondary Teaching Activities` <- as.numeric(demo.data$`Secondary Teaching Activities`)

# create new columns that give proportion of Gender
# percent = female gender divided by all female Gender
# demo.data <- demo.data  %>% 
#   group_by(Group) %>% 
#   mutate(Gender_percent = Gender/Sum_participants) %>% 
#   mutate(Gender_percent = round(sum(Gender_percent)*100, digits=0))

# create a basic table (tibble) using tidyverse functions
demo.table <- demo.data %>%
  group_by(Group) %>%
  summarise(N=n(),
            "Gender female in percent" = round(sum(Gender/Sum_participants) * 100, 
                                               digits = 2),
            "M Age in years" = round(mean(Age), 
                                     digits = 2),
            "SD Age in years" = round(sd(Age), 
                                      digits = 2),
            "Min Age in years" = min(Age),
            "Max Age in years" = max(Age)
            )

# # format and insert table in manuscript
# demo.table %>%
# papaja::apa_table(
#   caption = "Demographic Information",
#   # note = "Write Note here",
#   escape = TRUE, # if TRUE special Latex characters are escaped; if this is turned to F captions cannot be rendered. I don't know why...
#   placement = "h", # position of table in page:  exact location (h), at the top (t), bottom (b)
#   font_size = "tiny" # options are tiny, scriptsize, footnotesize, small, normalsize (default), large, Large, LARGE, huge, Huge
#   )


# create a basic table (tibble) using tidyverse functions
exp.table <- demo.data %>%
  group_by(Group) %>%
  summarise(N=n(),
           "M Exp." = round(mean(`Teaching Experience`), 2),
            "SD Exp." = round(sd(`Teaching Experience`), 2),
            "Min Exp." = min(`Teaching Experience`),
            "Max Exp." = max(`Teaching Experience`),
            "M Semester" = round(mean(Semester), 2),
            "SD Semester" = round(sd(Semester), 2),
            "Min Semester" = min(Semester),
            "Max Semester" = max(Semester),
            "M Internship" = round(mean(Internship), 2),
            "SD Internship" = round(sd(Internship), 2),
            "Min Internship" = min(Internship),
            "Max Internship" = max(Internship),
            "Extracurricular Teaching Experience" = round(sum(`Extracurricular Teaching Experience`/Sum_participants) * 100, digits = 2),
            "Secondary Teaching Activities" = round(sum(`Secondary Teaching Activities`/Sum_participants) * 100)
           )

# # format and insert table in manuscript
# exp.table %>%
# papaja::apa_table(
#   caption = "Teaching Experience in years, internship experience in teaching units (45min) and extracurricular teaching experience in percent",
#   # note = "Write Note here",
#   escape = TRUE, # if TRUE special Latex characters are escaped; if this is turned to F captions cannot be rendered. I don't know why...
#   placement = "h", # position of table in page:  exact location (h), at the top (t), bottom (b)
#   font_size = "tiny" # options are tiny, scriptsize, footnotesize, small, normalsize (default), large, Large, LARGE, huge, Huge
#   )
      

```

XXX  fitbit data exclusion XXX

The sample consisted of *N* = `r length(demo.data$Group)` participants with *n* = `r length(demo.data$Group[demo.data$Group == "Expert"])` expert teachers and *n* = `r length(demo.data$Group[demo.data$Group == "Novice"])` novice teachers. 

The inclusion criterion for experts was that they have successfully completed teacher training and are actively employed in the teaching profession. According to @palmer2005identifying, we selected teachers as experts who had at least three years of professional experience and ideally had worked in another teaching position, such as subject advisor or trainer for trainee teachers, in addition to their teaching profession in school. Novices were student teachers who had successfully completed their first internship in a school and gained one to four hours of teaching experience.

The expert teachers (`r demo.data %>% filter(Gender == 1 & Group == "Expert") %>% pull(Gender) %>% length()` women; `r demo.table %>% filter(Group == "Expert") %>% pull("Gender female in percent")`%) had a mean age of `r demo.data %>% filter(Group == "Expert") %>% pull(Age) %>% mean() %>% round(., digits = 1)` years (*SD* = `r demo.table %>% filter(Group == "Expert") %>% pull("SD Age in years") %>% round(., digits = 1)`; range: `r demo.table %>%  filter(Group == "Expert") %>% pull("Min Age in years")`-`r demo.table %>%  filter(Group == "Expert") %>% pull("Max Age in years")`) and an average teaching experience of `r exp.table %>% filter(Group == "Expert") %>% pull("M Exp.") %>% mean() %>% round(., digits = 1)` years (*SD* = `r exp.table %>% filter(Group == "Expert") %>% pull("SD Exp.") %>% round(., digits = 1)`; range: `r exp.table %>%  filter(Group == "Expert") %>% pull("Min Exp.")`-`r exp.table %>%  filter(Group == "Expert") %>% pull("Max Exp.")`). 
`r demo.data %>% filter(Group == "Expert" & School_type == "Primary School") %>% pull("Percent_schooltype") %>% unique()`% of the experts were primary school teachers and `r demo.data %>% filter(Group == "Expert" & School_type == "Secondary School") %>% pull("Percent_schooltype") %>% unique()`% were secondary school teachers. `r exp.table %>% filter(Group == "Expert") %>% pull("Secondary Teaching Activities")`% of the experienced teachers were also engaged in an secondary teaching activity, such as lecturers at the university, main training supervisors for trainee teachers and subject advisers. 

The novice teachers (`r demo.data %>% filter(Gender == 1 & Group == "Novice") %>% pull(Gender) %>% length()` women; `r demo.table %>% filter(Group == "Novice") %>% pull("Gender female in percent")`%) had a mean age of `r demo.data %>% filter(Group == "Novice") %>% pull(Age) %>% mean() %>% round(., digits = 1)` years (*SD* = `r demo.table %>% filter(Group == "Novice") %>% pull("SD Age in years") %>% round(., digits = 1)`; range: `r demo.table %>%  filter(Group == "Novice") %>% pull("Min Age in years")`-`r demo.table %>%  filter(Group == "Novice") %>% pull("Max Age in years")`) with an average teaching experience of `r exp.table %>% filter(Group == "Novice") %>% pull("M Exp.") %>% mean() %>% round(., digits = 1)` years. On average, the student teachers were in their `r exp.table %>% filter(Group == "Novice") %>% pull("M Semester") %>% mean() %>% round(., digits = 1)` semester (*SD* = `r exp.table %>% filter(Group == "Novice") %>% pull("SD Semester") %>% round(., digits = 1)`; range: `r exp.table %>%  filter(Group == "Novice") %>% pull("Min Semester")`-`r exp.table %>%  filter(Group == "Novice") %>% pull("Max Semester")`). Furthermore, they had an average teaching experience of `r exp.table %>% filter(Group == "Novice") %>% pull("M Internship") %>% mean() %>% round(., digits = 1)` teaching units à 45min (*SD* = `r exp.table %>% filter(Group == "Novice") %>% pull("SD Internship") %>% round(., digits = 1)`; range: `r exp.table %>%  filter(Group == "Novice") %>% pull("Min Internship")`-`r exp.table %>%  filter(Group == "Novice") %>% pull("Max Internship")`) through the internships during their studies. 
`r demo.data %>% filter(Group == "Novice" & School_type == "Primary School") %>% pull("Percent_schooltype") %>% unique()`% of the novices were studying to become primary school teachers, `r demo.data %>% filter(Group == "Novice" & School_type == "Secondary School") %>% pull("Percent_schooltype") %>% unique()`% to become secondary school teachers and `r demo.data %>% filter(Group == "Novice" & School_type == "Special Education") %>% pull("Percent_schooltype") %>% unique()`% to become special education teachers. `r exp.table %>% filter(Group == "Novice") %>% pull("Extracurricular Teaching Experience")`% of the student teachers were also engaged in an extracurricular teaching activity, such as tutoring or homework supervision. 

The subjects were primarily recruited through personal contacts, social media (Facebook), e-mail distribution lists and advertising in lectures at Leipzig University. All study procedures were carried out in accordance with the ethical standards of the University’s Institutional Review Board. The authors received a positive vote on the study procedures from the Ethics Committee Board of Leipzig University. All participants were informed in detail about the aim and intention of the study prior to testing. Participation in the study was voluntary and only took place after written consent has been given.


## Material
We used a Fitbit Charge 4 to measure the teachers' heart rate. The device was attached 2-finger widths above the ulnar styloid process to the subject’s wrist following the manufacturer’s instructions. To determine the heart rate, the Fitbit flashes green LEDs many times per second and uses light-sensitive photodiodes to measure the volume changes in the capillaries and then calculates how many times the heart beats per minute (bpm). Data were automatically wireless synced with an iPad via Bluetooth to a Fitbit account, and subsequently, the intraday second-by-second data were exported for each session using the opensource software Pulse Watch (PulseWatch. URL: https://iccir919.github.io/pulseWatch/public/index.html [accessed 2022-08-03]).


## Procedure
In a laboratory setting, three trained actors performed teaching disruptions in a counter balanced fashion while the subject taught a 15-minute micro-teaching unit prepared in advance. To record the subject's heart rate, the Fitbit Charge 4 was put on at least 10 minutes before the start of the lesson. The lesson was recorded by four cameras and an audio recorder. In addition, the subject wore eye-tracking glasses to record gaze behavior. 

Subsequently, the subjects as well as the actors were given a short questionnaire, which contained items to collect demographic information as well as items about the previously given lesson on teaching quality using a validated questionnaire (EMU, @helmke2014unterrichtsdiagnostik) and self developed scales on the teacher's presence behavior derived from the research literature via the online survey website SoSci Survey (4-point Likert scale; 1 = strongly disagree; 2 = disagree; 3 = agree; 4 = strongly agree). The completion of the questionnaire took approximately 5 minutes. 

The experimenter then conducted a Stimulated Recall Interview (SRI), where the subject commented and rated the reactions to classroom events while watching the eye tracking video.

Finally, a Situational Judgment Test (SJT, @gold2015development) was used to assess the subject's strategic knowledge of classroom management. The subject was asked to judge alternative actions on school scenarios on a 6-point rating scale from 1 (A) to 6 (F) according to school grades. Data from the SJT were again collected as an online questionnaire via the website www.soscisurvey.de and lastet approximately 10 minutes. 

The Fitbit watch was removed only after the last questionnaire to obtain heart rate at three different measurement time points: before, during, and after the lesson. 

## Data analysis
We used `r cite_r("r-references.bib")` for all our analyses.

### FitBit

All participants were given a FitBit Smart Watch Charge 4 to wear during the experiment. 

## Heart Rate

The heart rate of each subject were measured before, during and after the experiment.

XXX Data and data wrangling need to be imported XXX 
```{r}
# # Initial Preparations
# ## Run following Code if and only if new data is added to the initial data.
# 
# source(file = "data.wrangling.R")
# 
# 
# # Plots
# 
# df_heart_all <-
#   read_rds(file = "final_data/heart_all.rds") |> 
#   mutate(status = factor(status,
#                          levels = c("Expert","Novice"),
#                          labels = c("Expert","Novice")
#                          )
#          )
# 
# df_heart_min <-
#   read_rds(file = "final_data/heart_min.rds")
# 
# df_heart_aggr <- 
#   read_rds(file = "final_data/heart_aggr.rds") |> 
#   mutate(status = factor(status,
#                          levels = c("Novice","Expert"),
#                          labels = c("Novice","Expert")
#                          )
#          )
# 
# plot_flow <-
# ggplot(data = df_heart_all,
#        mapping = aes(x = as.numeric(Time),
#                      y = `Heart Rate`,
#                      group = ID)
#        ) +
#   geom_line(mapping = aes(color = status),
#             size = 0.3,
#             alpha = 1
#             ) +
#   xlim(0, min(df_heart_min$min)) +
#   scale_color_viridis_d(option = "A",
#                        end = 0.8)  +
#   scale_linetype_manual(values = c(1, 6)) +
#   labs(x = "Time (in Seconds)",
#        y = "Heart Rate\n(in Beats per Minute)") +
#   theme_minimal() +
#   theme(text = element_text(family = "serif"),
#         legend.position = "none",
#         strip.text = element_text(size = 16)) +
#   facet_grid(cols = vars(Type),
#              scales = "free_x")
# 
# plot_flow_leg <-
# ggplot(data = df_heart_all,
#        mapping = aes(x = Time,
#                      y = `Heart Rate`
#                      )
#        ) +
#   geom_smooth(mapping = aes(color = status),
#               method = "loess") +
#   scale_color_viridis_d(option = "A",
#                         end = 0.8) +
#  # scale_linetype_manual(values = c(1, 6)) +
#   theme_minimal() +
#   theme(text = element_text(family = "serif"),
#         legend.title = element_blank()) 
# 
# legend <- cowplot::get_legend(plot_flow_leg)
# 
# plot_loess <-
# ggplot(data = filter(df_heart_all),
#        mapping = aes(x = as.numeric(Time),
#                      y = `Heart Rate`
#                      )
#        ) +
#   stat_smooth(geom = "line",
#               mapping = aes(color = status),
#               method = "loess",
#               se = FALSE) +
#   xlim(0,min(df_heart_min$min)) +
#   scale_color_viridis_d(option = "A",
#                         end = 0.8) +
#   scale_linetype_manual(values = c(1, 6)) +
#   labs(x = "Time (in Seconds)",
#        y = "Heart Rate\n(in Beats per Minute)") +
#   theme_minimal() +
#   facet_grid(cols = vars(Type),
#              scales = "free_x",
#              ) +
#   theme(text = element_text(family = "serif"),
#         legend.position = "none",
#         strip.background = element_blank(),
#         strip.text.x = element_blank()
#         )
# 
# plot_box <- 
# ggplot(data = df_heart_aggr,
#        mapping = aes(x = Type,
#                      y = mean,
#                      color = status
#                      )
#        ) +
#   geom_boxplot(color = "darkgrey",
#                fill = "grey") +
#   geom_line(data = filter(df_heart_aggr,
#                           status == "Novice"),
#             mapping = aes(x = Type,
#                           y = mean,
#                           group = as_factor(ID)
#                           ),
#             linetype = 1,
#             alpha = 0.5
#             ) +
#   geom_line(data = filter(df_heart_aggr,
#                           status == "Expert"),
#             mapping = aes(x = Type,
#                           y = mean,
#                           group = as_factor(ID)
#                           ),
#             linetype = 6,
#             alpha = 0.5
#             ) +
#   geom_point(size = 2,
#              alpha = 0.5) +
#   labs(x = "",
#        y = "Average Heart Rate\n(in Beats per Minute)") +
#   scale_color_viridis_d(option = "A",
#                        end = 0.8) +
#   theme_minimal() +
#   theme(text = element_text(family = "serif"),
#         strip.text = element_blank(),
#        legend.position = "none",
#         axis.text.x = element_blank()
#         ) +
#   aes(fill = Type)
# 
# lo_mat <- rbind(c(1,1,1,1,1,1,NA),
#                 c(2,2,2,2,2,2,4),
#                 c(3,3,3,3,3,3,NA))
# 
# plot_heart <- 
# grid.arrange(grobs = list(plot_flow, plot_loess, plot_box, legend),
#              layout_matrix = lo_mat)
# 
# plot_heart
```

### Steps

Using the FitBit we measured the steps a person walked during the experiment as well. We validated the steps in six randomly selected videos by manual step counting. A step was considered to be the movement of the subject's foot forward, backward, or sideways. The measurement was not as reliable as hoped.

```{r}
# df_steps <- read_rds(file = "final_data/steps.rds")
# set.seed(5678)
# ggplot(data = df_steps,
#        mapping = aes(x = type,
#                      y = Steps
#                      )
#        ) +
#   geom_boxplot(mapping = aes(color = type),
#                fill = "grey",
#                alpha = 0.6) +
#   geom_jitter(mapping = aes(color = type),
#               alpha = 0.9,
#               width = 0.3) + 
#   scale_color_viridis_d(option = "A",
#                        end = 0.8) +
#   labs(x = "",
#        y = "Steps During\nMain Phase") +
#   theme_minimal() +
#   theme(text = element_text(family = "serif"),
#         legend.title = element_blank(),
#         axis.text.x = element_blank(),
#         axis.ticks.x = element_blank()
#         ) 
# 
# ### Validation of steps 
# # selecting some rows at random with sample_n()
# sample_n(df_steps, 6)
# 
# # random ID Output:
# # Novices ID: 102, 125, 110
# # Experts ID: 219, 218, 214
# 
# # Results from manual step counting:
# # Novices ID: 110 -> 178 steps; 102 -> 219 steps; 125 -> 319 steps
# # Experts ID: 214 -> 437 steps; 218 -> 195 steps; 219 -> 530 steps

```


# Results

# Discussion and implication


\newpage

# References

::: {#refs custom-style="Bibliography"}
:::
