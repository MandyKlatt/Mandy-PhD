---
title             : "New approaches to teachers' experience of stress: Do heart rate measurements with fitness trackers provide an efficient, inexpensive, and robust measurement method?"
shorttitle        : "Using fitbit to measure teachers' heart rate"

author: 
  - name          : "Mandy Klatt"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Dittrichring 5-7, 04109 Leipzig"
    email         : "mandy.klatt@uni-leipzig.de"
    role:         # Contributorship roles (e.g., CRediT, https://casrai.org/credit/)
      - "Conceptualization"
      - "Writing - Original Draft Preparation"
      - "Writing - Review & Editing"
  - name          : "Peer Keßler"
    affiliation   : "1"
    role:
      - "Writing - Original Draft Preparation"
      - "Writing - Review & Editing"
  - name          : "Gregor Kachel"
    affiliation   : "1,2"
    role:
      - "Conceptualization"
      - "Writing - Original Draft Preparation"
      - "Writing - Review & Editing"
  - name          : "Christin Lotz"
    affiliation   : "1"
    role:
      - "Conceptualization"
      - "Writing - Original Draft Preparation"
      - "Writing - Review & Editing"
  - name          : "Anne Deiglmayr"
    affiliation   : "1"
    role:
      - "Supervision"

affiliation:
  - id            : "1"
    institution   : "Leipzig University"
  - id            : "2"
    institution   : "Max Planck Institute for Evolutionary Anthropology"

authornote: |
  We received funding from QualiFond of University Leipzig. We have no conflicts of interest to disclose. This article is based on data used at conference presentations (DACH-Nachwuchsakademie, 2022; EARLI SIG 11, 2022; EARLI SIG 27, 2022). 
 
abstract: |
  One or two sentences providing a **basic introduction** to the field,  comprehensible to a scientist in any discipline.
  
  Two to three sentences of **more detailed background**, comprehensible  to scientists in related disciplines.
  
  One sentence clearly stating the **general problem** being addressed by  this particular study.
  
  One sentence summarizing the main result (with the words "**here we show**" or their equivalent).
  
  Two or three sentences explaining what the **main result** reveals in direct comparison to what was thought to be the case previously, or how the  main result adds to previous knowledge.
  
  One or two sentences to put the results into a more **general context**.
  
  Two or three sentences to provide a **broader perspective**, readily comprehensible to a scientist in any discipline.
  
  <!-- https://tinyurl.com/ybremelq -->
  
keywords          : "heart rate; photoplethysmography; wearable electronic device; teaching"
wordcount         : "X"

bibliography      : "r-references.bib"

floatsintext      : no
linenumbers       : yes
draft             : no
mask              : no

figurelist        : no
tablelist         : no
footnotelist      : no

classoption       : "man"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
library("papaja")
r_refs("r-references.bib")
```

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```

```{r data wrangling, include=FALSE}

library(needs)
needs(ltm,
      broom,
      ppcor,
      jtools,
      lm.beta,
      tidyverse,
      janitor,
      lubridate,
      readxl,
      ggthemes,
      gridExtra,
      imputeTS,
      DescTools,
      cowplot,
      rstatix,
      ggpubr,
      lme4,
      viridis)

# disruption & confidence rating
df_rating <- 
  excel_sheets("data/Coding_SRI.xlsx") %>% 
  map_df(~read_xlsx("data/Coding_SRI.xlsx",.)) %>% # read in data with two sheets
  select(ID, # select relevant columns 
         disruption_factor, # -99 = subject did not notice event; -100 = experimenter did not asked for event
         confident_factor,
         event
         ) %>% 
  mutate(disruption_factor = ifelse(disruption_factor < 0,
                                    yes = NA,
                                    no = disruption_factor
                                    ),
         confident_factor = ifelse(confident_factor < 0,
                                   yes = NA,
                                   no = confident_factor),
         event = as_factor(event)
         )

# demographic data
df_demo <- 
  read_excel("./data/data_empschul_labor_lehrperson.xlsx") %>% # read in excel 
  transmute(ID = LI06_05, # select and rename relevant columns 
            # gender = factor(LI02_01_1,
            #                 levels = 1:2,
            #                 labels = c("male","female")
            #                 ),
            gender = LI02_01_1, # 1 = male; 2 = female
            age = LI03_01, 
            teaching_experience = LI04_01)
            # school_type = LI18)
            # term = LI11_01, 
            # extracurricular_teaching_experience = LI14,
            # secondary_teaching_activities = LI17)

# merge two data frames by ID 
df_merge <- merge(df_demo,
                  df_rating,
                  by = "ID") %>% 
  filter(!ID %in% c("126", # exclude cases with no fitbit data (to check see data Heart Rate)
                    "132")
         )

# rm(list = c("df_demo","df_rating"))


data_path <- "./data/heart_rate_data"

main <-
map(.x = dir(path = data_path,
             pattern = ".csv"),
    ~ read_csv(file.path(data_path, .), 
               id = "id",
               col_types = c("t","n")
               ) %>% 
  mutate(time = .$Time - min(.$Time),
         time = as.numeric(time),
         heart_rate = `Heart Rate`,
         ID = id,
         time_span = case_when(str_detect(string = id, pattern = "_a") ~ "after",
           str_detect(string = id, pattern = "_m") ~ "main",
           str_detect(string = id, pattern = "_p") ~ "pre",
           str_detect(string = id, pattern = "_s") ~ "subsequent",
           str_detect(string = id, pattern = "_i") ~ "interview",
           TRUE ~ "overall"
           ),
         ID = str_extract(string = ID,
                          pattern = "[:digit:]{3}"),
         ID = as.numeric(ID)
      ) %>%
      filter(time <= 600) %>%
    select(!c("Time","Heart Rate","id"))
    ) %>%
  bind_rows()

main <-
  left_join(main, df_merge,
            by = "ID")

```

```{r, include=FALSE}
options(tinytex.verbose = TRUE)
```

# Introduction
Physiological data such as heart rate are becoming increasingly important in research on stress experience. They represent an important indicator of physical or emotional stress, as increased workload is associated with increased heart rate [@sachs2014physiologische]. Furthermore, they allow a more objective recording of stress than self-reports [@rungeusing]. However, capturing heart rate in an educational context requires the use of low-cost and non-invasive instruments. Fitness trackers worn on the wrist have the potential to be such a useful tool [@ferguson2015validity].

To date, there is still little evidence on the usefulness of heart rate measurements using fitness trackers in teaching and learning settings [@ertzberger2016use; @lowe2016educational]. @rungeusing alone examined teacher stress in a relatively small sample (*N* = 4 teachers) and showed that high heart rate, high step count, and little sleep indicate more stress in teachers.

Thus, there remains a lack of robust studies on whether fitness trackers are an efficient, inexpensive, and robust measurement method for assessing teachers' experience of stress. Since, among other things, greater professional experience is associated with lower feelings of stress in the teaching profession [@fisher2011factors], this study will also consider the heart rate measurements of experienced and inexperienced teachers.
 

## Aim of the study
Against this background, we investigated whether heart rate measurements using fitness trackers in a controlled teaching-learning setting are suitable to map differences between (1) anticipation, arousal, and rest phases. We expected heart rates to be higher in the arousal phase than in the rest phases.


# Methods
We report how we determined our sample size, all data exclusions (if any), all manipulations, and all measures in the study. <!-- 21-word solution (Simmons, Nelson & Simonsohn, 2012; retrieved from http://ssrn.com/abstract=2160588) -->

## Participants
```{r demographicstable, include = TRUE, echo=FALSE}

# changing gender to count female gender (male = 2 --> 0)
df_demo$gender = ifelse(df_demo$gender == 2, "1","0")

# changing character Gender into numeric
df_demo$gender <- as.numeric(df_demo$gender)

# creating new column with total participants to calculate percent of gender
df_demo <- df_demo %>%
  mutate(sum_participants = sum(n()))


# create a basic table (tibble) using tidyverse functions
df_demo_table <- df_demo %>%
  summarise(N=n(),
            "Gender female in percent" = round(sum(gender/sum_participants) * 100,
                                               digits = 2),
            "M Age in years" = round(mean(age),
                                     digits = 2),
            "SD Age in years" = round(sd(age),
                                      digits = 2),
            "Min Age in years" = min(age),
            "Max Age in years" = max(age),
            "M Teaching Experience in years" = round(mean(teaching_experience),
                                            digits = 2),
            "SD Teaching Experience in years" = round(sd(teaching_experience),
                                            digits = 2),
            "Min Teaching Experience in years" = min(teaching_experience),
            "Max Teaching Experience in years" = max(teaching_experience)
            )

# # format and insert table in manuscript
# df_demo_table %>%
# papaja::apa_table(
#   caption = "Demographic Information",
#   # note = "Write Note here",
#   escape = TRUE, # if TRUE special Latex characters are escaped; if this is turned to F captions cannot be rendered. I don't know why...
#   placement = "h", # position of table in page:  exact location (h), at the top (t), bottom (b)
#   font_size = "tiny" # options are tiny, scriptsize, footnotesize, small, normalsize (default), large, Large, LARGE, huge, Huge
#   )
      

```

The sample consisted of *N* = `r length(df_demo$ID)` participants. Data of two participants were excluded from the analyses due to insufficient data quality. 

The subjects (`r df_demo %>% filter(gender == 1) %>% pull(gender) %>% length()` women; `r df_demo_table %>% pull("Gender female in percent")` %) had a mean age of `r df_demo %>% pull(age) %>% mean() %>% round(., digits = 1)` years (*SD* = `r df_demo_table %>% pull("SD Age in years") %>% round(., digits = 1)`; range: `r df_demo_table %>%  pull("Min Age in years")`-`r df_demo_table %>% pull("Max Age in years")`) and an average teaching experience of `r df_demo_table %>% pull("M Teaching Experience in years")` years (*SD* = `r df_demo_table %>% pull("SD Teaching Experience in years")`; range: `r df_demo_table %>% pull("Min Teaching Experience in years")`-`r df_demo_table %>% pull("Max Teaching Experience in years")`). 



## Material
We used a Fitbit Charge 4 to measure the teachers' heart rate. The device was attached 2-finger widths above the ulnar styloid process to the subject’s wrist following the manufacturer’s instructions. To determine the heart rate, the Fitbit flashes green LEDs many times per second and uses light-sensitive photodiodes to measure the volume changes in the capillaries and then calculates how many times the heart beats per minute (bpm). Data were automatically wireless synced with an iPad via Bluetooth to a Fitbit account, and subsequently, the intraday second-by-second data were exported for each session using the opensource software Pulse Watch (PulseWatch. URL: https://iccir919.github.io/pulseWatch/public/index.html [accessed 2022-08-03]).


## Procedure
In a laboratory setting, three trained actors performed teaching disruptions in a counter balanced fashion while the subject taught a 15-minute micro-teaching unit prepared in advance. To record the subject's heart rate, the Fitbit Charge 4 was put on at least 10 minutes before the start of the lesson. The lesson was recorded by four cameras and an audio recorder. In addition, the subject wore eye-tracking glasses to record gaze behavior. 

Subsequently, the subjects as well as the actors were given a short questionnaire, which contained items to collect demographic information as well as items about the previously given lesson on teaching quality using a validated questionnaire (EMU, @helmke2014unterrichtsdiagnostik) and self developed scales on the teacher's presence behavior derived from the research literature via the online survey website SoSci Survey (4-point Likert scale; 1 = strongly disagree; 2 = disagree; 3 = agree; 4 = strongly agree). The completion of the questionnaire took approximately 5 minutes. 

The experimenter then conducted a Stimulated Recall Interview (SRI), where the subject commented and rated the reactions to classroom events while watching the eye tracking video.

Finally, a Situational Judgment Test (SJT, @gold2015development) was used to assess the subject's strategic knowledge of classroom management. The subject was asked to judge alternative actions on school scenarios on a 6-point rating scale from 1 (A) to 6 (F) according to school grades. Data from the SJT were again collected as an online questionnaire via the website www.soscisurvey.de and lastet approximately 10 minutes. 

The Fitbit watch was removed only after the last questionnaire to obtain heart rate at three different measurement time points: before, during, and after the lesson. 

## Data analysis
We used `r cite_r("r-references.bib")` for all our analyses.

### FitBit

All participants were given a FitBit Smart Watch Charge 4 to wear during the experiment. 

## Heart Rate

The heart rate of each subject were measured before, during and after the experiment.

```{r}
# Initial Preparations

## Run following Code only if new data is added to the initial data.
# 
# source(file = "data.wrangling.R")
# 
# # aggregate data 
# df_heart_all <-
#   read_rds(file = "data/heart_all.rds") |> 
#   mutate(status = factor(status,
#                          levels = c("Expert","Novice"),
#                          labels = c("Expert","Novice")
#                          )
#          )
# 
# df_heart_min <-
#   read_rds(file = "data/heart_min.rds")
# 
# df_heart_aggr <- 
#   read_rds(file = "data/heart_aggr.rds") |> 
#   mutate(status = factor(status,
#                          levels = c("Novice","Expert"),
#                          labels = c("Novice","Expert")
#                          )
#          )
# 
# 
# # Mean, SD, t-test & Cohen D for experts & novices
# # novices
# mean_nov <- 
#   df_heart_aggr %>%
#   filter(status == "Novice" ) %>% 
#   pull(mean) %>% 
#   mean() %>% 
#   round(., digits = 0)
# 
# sd_nov <- 
#   df_heart_aggr %>%
#   filter(status == "Novice") %>% 
#   pull(mean) %>% 
#   sd() %>% 
#   round(., digits = 0)
# 
# # experts
# mean_exp <-
#   df_heart_aggr %>%
#   filter(status == "Expert") %>% 
#   pull(mean) %>% 
#   mean() %>% 
#   round(., digits = 0)
# 
# sd_exp <- 
#   df_heart_aggr %>%
#   filter(status == "Expert") %>% 
#   pull(mean) %>% 
#   sd() %>% 
#   round(., digits = 0)
# 
# # t-test for expertise differences
# t.test(x = df_heart_aggr$mean[df_heart_aggr$status == "Expert"],
#        y = df_heart_aggr$mean[df_heart_aggr$status == "Novice"])
# 
# 
# # effect size for expertise differences
# d_heartrate <- CohenD(x = df_heart_aggr$mean[df_heart_aggr$status == "Expert"],
#                y = df_heart_aggr$mean[df_heart_aggr$status == "Novice"],
#                na.rm = TRUE)
# 
# 
# # Plots
# 
# plot_flow_leg <-
# ggplot(data = df_heart_all,
#        mapping = aes(x = Time,
#                      y = `Heart Rate`
#                      )
#        ) +
#   xlim(0, 600) +
#   geom_smooth(mapping = aes(color = status),
#               method = "loess") +
#   scale_color_viridis_d(option = "A",
#                         end = 0.8) +
#   scale_linetype_manual(values = c(1, 6)) +
#   labs(x = "Time (in Seconds)",
#        y = "Heart Rate\n(in Beats per Minute)") +
#   ggtitle("Experts' and novices' heart rate per phase") +
#   theme_minimal() +
#   theme(text = element_text(family = "serif"),
#         legend.text = element_text(size = 15),
#         legend.title = element_blank(),
#         axis.text.x = element_text(size = 12),
#         axis.text.y = element_text(size = 10),
#         strip.text = element_text(size = 16),
#         plot.title = element_text(size = 20, 
#                                   face = "bold")) +
#   facet_grid(cols = vars(Type),
#              scales = "free_x")
# 
# # saving plot 
# ggsave(plot = plot_flow_leg,
#        filename = "plots/plot_flow_leg.svg",
#        height = 5,
#        width = 8,
#        units = "in")

```


### Steps

Using the FitBit we measured the steps a person walked during the experiment as well. We validated the steps in six randomly selected videos by manual step counting. A step was considered to be the movement of the subject's foot forward, backward, or sideways. The measurement was not as reliable as hoped.

```{r}
# df_steps <- read_rds(file = "data/steps.rds")
# set.seed(5678)
# ggplot(data = df_steps,
#        mapping = aes(x = type,
#                      y = Steps
#                      )
#        ) +
#   geom_boxplot(mapping = aes(color = type),
#                fill = "grey",
#                alpha = 0.6) +
#   geom_jitter(mapping = aes(color = type),
#               alpha = 0.9,
#               width = 0.3) +
#   scale_color_viridis_d(option = "A",
#                        end = 0.8) +
#   labs(x = "",
#        y = "Steps During\nMain Phase") +
#   theme_minimal() +
#   theme(text = element_text(family = "serif"),
#         legend.title = element_blank(),
#         axis.text.x = element_blank(),
#         axis.ticks.x = element_blank()
#         )
# 
# ### Validation of steps
# # selecting some rows at random with sample_n()
# sample_n(df_steps, 6)
# 
# # random ID Output:
# # Novices ID: 102, 125, 110
# # Experts ID: 219, 218, 214
# 
# # Results from manual step counting:
# # Novices ID: 110 -> 178 steps; 102 -> 219 steps; 125 -> 319 steps
# # Experts ID: 214 -> 437 steps; 218 -> 195 steps; 219 -> 530 steps

```


# Results

# Discussion and implication


\newpage

# References

::: {#refs custom-style="Bibliography"}
:::
